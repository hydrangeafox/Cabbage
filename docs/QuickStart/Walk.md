# walk.js

`walk.js` は単一のページ内で関心のあるコンテンツを収集するスクリプトである。
クイックスタートの第一歩はここから始めることになる。

本スクリプトの中核部分はとても単純である。

```js
el.querySelector(val)?.textContent
```

`val` が示す要素を文書内で選択し、その「内容」を取得する。
たったこれだけである。

> [!NOTE]
> 一般にウェブページのリンクを辿って情報をかき集めるプログラムをクローラと呼ぶ。
> 本スクリプトは「一歩進むだけ」なので、これをもじって `walk.js` とした。

## First step

とりあえず、このスクリプトで何ができるのか試してみよう。

> [!WARNING]
> 多数の記事の収集には大量のデータ送受信が伴う。
> よって、各スクリプトの実行は定額制回線の利用を推奨する。

1. ブラウザで[対象期間](./index.md#planning)内 **最初の** 記事を開く
2. [開発者コンソール](./index.md#devtools)を開く
3. [walk.js](../../src/walk.js) をクリップボードへコピー:  
   リンク先のページ内検索で [Raw] を探し、その右隣にあるコピーボタンを押す。
4. クリップボードの内容をコンソールにペーストする:  
   最下部(Safari)または最上部(Edge)のプロンプト(`>`)行に入力する。
6. [Return] キーを押して実行... 数秒後:
    - コンソールに記事番号を表示(`Stored as #12345`)
    - ウェブページ内の画像がより大きめのプレビュー画像に切り替わる
    - 次の記事へ移動(それが存在する場合)

ページ遷移しただけみたいだけど... 一体、何が起こったのか?

- `Stored as` はブラウザ[内部領域][localStorage]への保存完了を示している
- そこには(サムネイルではなく)プレビュー画像の **URL** も含まれている
- そして、次の記事を回収しやすいように自動的にページを移動した

[localStorage]: https://developer.mozilla.org/docs/Web/API/Window/localStorage

## Second step

上手くいったようなので、次の記事も収集してみよう。
まずは、ページの **読み込みが完了するまで** しばらく待つ。
そして、コンソールに上述のスクリプトをもう一回ペーストする...
よりは **実行履歴** を呼び出すのが簡単だろう。

1. プロンプト行が空のとき `Up` (上矢印)キーを押す:  
   直前の実行履歴が呼び出される。
2. [Return] キーを押す:  
   呼び出したスクリプトを再度実行する。

以上の操作を[回収範囲の終点](./index.md#planning)まで繰り返していくことになる。

> [!TIP]
> スクリプトが複数行で構成されるとき、上下キーで挿入ポイントを移動できる。
> さらに入力行の最上部へ到達すると、直前の実行履歴を呼び出す。
> なお、Emacs 使いには慣れ親しんだキーアサインが(一部)通用するのも嬉しい。

## Last stop

人間は同じ操作を繰り返しているとミスを犯しやすい。
つまり「終点」が分かっていてもそこを通り越してしまうのだ。
そこで、あらかじめ終点を設定しておく **自動停止機能** を導入した。
もちろん、乗り過ごさない自信があればアラームを設定しておく必要はない。

1. 本スクリプトを「テキストエディット」等、お好みのエディタにペーストする:  
   コンソール上で直接パラメータを編集することも可能 **では** ある。
2. 最後から二行目の `Infinity`
   を[終点](./index.md#planning)の記事番号へ書き換える
3. 書き換えたスクリプトをコピーし、コンソールにペーストして実行
4. 履歴の呼び出しと実行を繰り返す:  
   スクリプトが終点を検出するとコンソールへ `Done` と表示。
   そうでなく、次の記事もなければ `Complete` と表示(つまり、最新の記事)

テキストエディタは何がよいだろうか?
現在も一番人気は Microsoft の _Visual Studio Code_ だろう(無償で利用可)
私はインストール版を使用しているが [ウェブ版][VS Code Web] もあるそうだ。

[VS Code Web]: https://vscode.dev

ひとつの区間の情報を収集したら、データを[集約](./Aggregate.md)してみよう。
