# Crawl.js

[walk.js](./Walk.md) の問題点は「一件の記事しか回収しない」ということである
(まさにその名前通り、将棋の「歩兵」に相当する)
これは記事数の多いブログでの作業量増加を意味している。
そして、単純作業の増加はケアレスミスに直結する。
この問題を解決するために `crawl.js` を作成した。

> [!NOTE]
> 開発者コンソールやスクリプトのコピー方法は[前章](./Walk.md)を参照のこと。
> また、注意事項もあるため前章を一読されたい。

1. ブログの記事一覧ページを表示する:  
   記事数が多い場合、10件あるいは20件ごとにページが分割されているだろう。
2. 記事の並べ替え順を[作成日時の降順](./index.md#planning)に設定する:  
   本章では全回収工程を通じて「新規投稿が発生しない」ことを前提としている。
   もし新規投稿があれば、ページまたぎ時に回収漏れが発生する可能性がある。
3. [ページネータ][Paginations]により最初期の一覧へ移動する:  
   例えば 100件の記事を20件ごとに表示する場合、5番目の区間が最初期である。
4. 以下の文をコンソールに入力・実行し、ポップアップブロッカーを起動する:  
   `window.open(document.location.origin);`
5. ブラウザアドレス欄右端のポップアップブロックアイコンをクリックする:  
   タブを閉じるまで、ポップアップブロックを一時無効とした。
6. [crawl.js](../../src/crawl.js) をコンソールにペースト、実行する:  
   数秒ごとに記事のタブが自動的に開かれては閉じていく。
   また、実行元タブのコンソールに
   `Stored matadata as #12345` といったメッセージが表示されている。
7. 現在表示中「区間」の回収完了時、コンソールに以下のようなメッセージが現れる:  
   `Wrote 20 entries`

[Paginations]: https://vuetifyjs.com/components/paginations/

> [!TIP]
> 記事の自動回収中はブラウザに触れないようにする。
> もし、回収処理を中断するならコンソール付きの「実行元タブ」を閉じる。

以上で、記事一覧におけるひとつの区間の情報を[内部領域][localStorage]へ蓄積した。
次の区間へ進んでいきたいところだが、一旦データを[集約](./Aggregate.md)しておく。
なぜなら、[期間](./index.md#planning)で説明した各種問題を回避するためである。

[localStorage]: https://developer.mozilla.org/docs/Web/API/Window/localStorage
